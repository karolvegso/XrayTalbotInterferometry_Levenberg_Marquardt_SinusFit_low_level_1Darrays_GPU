# XrayTalbotInterferometry_Levenberg_Marquardt_SinusFit_low_level_1Darrays_GPU
I post here the software for the calculation of X-ray Talbot Interferometric data using low-level sinus fitting in C++ and using only 1D array representation of matrices on the GPU. This software was compiled in CUDA C 12.2 in Visual Studio 2022 without errors. However, the image calculations are not running. Could you try to solve it by yourself? I do not know what to do until I submit this problem to Stack Overflow for the help of highly skilled programmers on this friendly planet. 

I post here the software for the calculation of X-ray Talbot Interferometric data using sinus fitting in C++. I am using the Levenberg-Marquardt algorithm to perform sinusoidal fit. In the algorithm presented here, the function for Levenberg-Marquardt is called levamr_sinus. It is a device function. The sinusoidal function has form a*sin(x+b)+c, where a is the amplitude, b is the phase, and c is the offset. The algorithm uses Jacobian matrix J, in which the first column contains the derivation of the sinus function according to the amplitude, the second column contains the derivation of the sinus function according to the phase, and the third column contains the derivation of the sinus function according to the offset. The Jacobian matrix J is here defined as a 1D array. All matrices and vectors are here defined as 1D arrays. The algorithm uses the multiplication of the matrices in 1D array form. In addition, the Levenberg-Marquardt algorithm contains the calculation of the inversion matrix in 1D array form. The Levenberg-Marquardt algorithm uses only for-cycles. Therefore, it should be very fast, suitable for fast calculations.

This program calculates differential phase image, visibility image, and absorption image measured by a fringe-scanning technique using X-ray Talbot Interferometry or X-ray grating interferometry. In the zip folder <dph_abs_vis_images_calc_Momose_approach_data.zip>, are 5 foregroung (fg) images and 5 background (bg) images. The number 5 means that the position of the amplitude grating was changed in 5 steps. In each pixel, the 5 intensity values for 5 foreground and 5 background images lies on the sinus curve. The Levenberg-Marquardt algorithm for fitting the sinusoidal function is used to fit this sinus curve for foreground and background data. The results of the fitting are amplitude value, phase value, and offset value for each pixel. From these fitting values, the differential phase, visibility, and absorption images are calculated.

The sinusoidal function is one of the basic non-linear functions. The sinusoidal function is frequently used in optics in interferometry or electronics. Knowing the low-level algorithm for fitting sinusoidal functions can be very useful in X-ray Talbot interferometry or grating interferometry. Here, I post Levenbergâ€“Marquardt algorithm for fitting simple sinusoidal functions. The C++ function <levmar_sinus> in the posted algorithm is doing that. The study material and detailed explanation of the algorithm is posted by the Technical University of Denmark by Madsen, Nielsen, and Tingleff on the web page http://www2.imm.dtu.dk/pubdb/edoc/imm3215.pdf. The presented algorithm fits the amplitude, phase, and offset of a sinusoidal function.

The Levenberg-Marquardt algorithm posted here is not using any matrix and vector manipulation library like Eigen C++ template library for linear algebra: matrices, vectors, numerical solvers, and related algorithms. The presented algorithm uses the full potential of C++ fast calculations. The algorithm shows why the basics of numerical methods should be taught to students at universities.
